# 每日新闻推送项目 - 开发记录

## 📝 项目概述

这是一个自动化的每日新闻推送系统，通过 GitHub Actions 定时执行，将新闻、天气等信息推送到微信。

### 项目信息
- **GitHub 仓库**: https://github.com/angelbaby12138one-netizen/daily-news-to-wechat
- **推送服务**: PushPlus
- **自动化平台**: GitHub Actions
- **执行时间**: 每天 8:00 AM 和 8:00 PM（北京时间）
- **目标城市**: 石家庄
- **开发语言**: Python 3.11.7

---

## 🚀 开发过程

### 第一阶段：需求确定

**初始需求**：
- 每天自动发送新闻到微信
- 使用 PushPlus 作为推送服务
- 通过 GitHub Actions 实现自动化

**功能需求**：
1. 热点新闻（知乎/百度热榜）
2. 科技新闻（36氪、少数派、爱范儿）
3. AI 新闻（机器之心、36氪AI）
4. 天气预报（石家庄）
5. 今日头条热榜
6. 抖音热榜
7. 穿衣建议（根据温度智能推荐）

### 第二阶段：本地开发与测试

**环境搭建**：
1. 安装 Python 3.11.7
2. 安装依赖：`requests`、`feedparser`

**核心功能实现**：
- `NewsFetcher` 类：负责获取各类新闻和天气数据
- `MessagePusher` 类：负责推送到 PushPlus
- 多个 API 源，并实现了备用方案（fallback）

**技术亮点**：
- 多数据源聚合（知乎、百度、今日头条、抖音、RSS）
- 失败重试机制（主API失败自动切换备用API）
- 智能温度穿衣建议
- 移动端优化的 HTML 设计

### 第三阶段：UI 设计演进

**设计迭代**：

1. **第一版**：赛博朋克深色主题
   - 用户反馈：太丑了，手机观看不美观

2. **第二版**：简洁白苹果风格
   - 灵感：Apple 官网设计
   - 配色：#f5f5f7（背景）、#007aff（链接）、#ff3b30（热度标签）
   - 字体：-apple-system, SF Pro Display
   - 用户反馈：顶部统计栏很奇怪

3. **第三版**（最终版）：优化简洁白
   - 移除统计栏
   - 简化时间显示
   - 保持清爽易读的设计

### 第四阶段：内容优化

**遇到的问题**：
- PushPlus 内容长度限制：20,000 字符

**优化方案**：
- 减少各模块数量：
  - 热点新闻：10条 → 6条
  - 今日头条：10条 → 6条
  - 抖音热榜：10条 → 6条
  - 科技新闻：10条 → 5条
  - AI 新闻：8条 → 3条
- 缩短摘要长度：100字符 → 50字符
- 仅在前几条显示摘要

### 第五阶段：GitHub 部署

**部署步骤**：

1. **创建 GitHub 账号**
   - 用户名：angelbaby12138one-netizen

2. **创建仓库**
   - 仓库名：daily-news-to-wechat
   - 可见性：Public（免费使用 Actions）

3. **配置 Git**
   ```bash
   git config --global user.name "angelbaby12138one-netizen"
   git config --global user.email "angelbaby12138one-netizen@users.noreply.github.com"
   ```

4. **推送代码**
   ```bash
   cd C:\Users\KK~\daily-news-to-wechat
   git init
   git add .
   git commit -m "初始化：每日新闻自动推送"
   git branch -M main
   git remote add origin https://github.com/angelbaby12138one-netizen/daily-news-to-wechat.git
   git push -u origin main
   ```

5. **配置 GitHub Secrets**
   - `PUSH_KEY`: dea6cc943ca742e1b2c9d49d896b9cc1
   - `PUSH_TYPE`: pushplus
   - `CITY`: 石家庄

6. **启用 GitHub Actions**
   - 工作流文件：`.github/workflows/daily-news.yml`
   - 定时任务：每天 8:00 和 20:00（北京时间）

### 第六阶段：问题修复

**问题 1：天气城市错误**
- **现象**：一直显示北京天气，而非石家庄
- **原因**：工作流配置文件缺少 `CITY` 环境变量
- **解决**：
  ```yaml
  env:
    PUSH_TYPE: ${{ secrets.PUSH_TYPE }}
    PUSH_KEY: ${{ secrets.PUSH_KEY }}
    CITY: ${{ secrets.CITY }}  # 添加这一行
  ```

**问题 2：用户想要穿衣建议**
- **需求**：根据天气温度推荐穿什么衣服
- **实现**：
  - 添加 `get_clothing_suggestion()` 方法
  - 根据温度分级推荐：
    - ≥28°C：短袖短裤
    - 23-28°C：短袖长裤
    - 18-23°C：长袖薄外套
    - 13-18°C：薄外套或卫衣
    - 8-13°C：厚外套
    - 3-8°C：冬装外套
    - <3°C：羽绒服或棉衣
  - 在天气卡片中显示穿衣建议

---

## 📂 项目结构

```
daily-news-to-wechat/
├── .github/
│   └── workflows/
│       └── daily-news.yml        # GitHub Actions 工作流配置
├── news_fetcher.py               # 主程序
├── requirements.txt              # Python 依赖
├── .gitignore                    # Git 忽略文件
├── README.md                     # 项目说明
├── 部署指南.md                   # 部署教程
├── GitHub注册指南.md             # GitHub 注册教程
├── 上传命令.md                   # 代码上传命令
├── 如何查看GitHub用户名.md       # 用户名查看指南
├── 功能说明.md                   # 功能详细说明
└── 开发记录.md                   # 本文件
```

---

## 🔧 核心技术

### 数据源

1. **热点新闻**
   - 主：知乎热榜 API
   - 备：百度热搜 API

2. **今日头条**
   - 主：今日头条热榜 API
   - 备：RSSHub

3. **抖音热榜**
   - 主：抖音热搜 API
   - 备：RSSHub

4. **科技新闻**
   - 36氪 RSS
   - 少数派 RSS
   - 爱范儿 RSS

5. **AI 新闻**
   - 机器之心 RSSHub
   - 36氪AI RSSHub
   - 备：从科技新闻中筛选 AI 关键词

6. **天气预报**
   - 主：wttr.in API
   - 备：易客天气 API

### 推送服务

**PushPlus**：
- 官网：http://www.pushplus.plus/
- Token：dea6cc943ca742e1b2c9d49d896b9cc1
- 支持 HTML 格式
- 内容限制：20,000 字符

### 自动化执行

**GitHub Actions**：
- 免费额度：公开仓库无限制
- 定时执行：Cron 表达式
  - `0 0 * * *`：北京时间 8:00 AM
  - `0 12 * * *`：北京时间 8:00 PM
- 手动触发：`workflow_dispatch`

---

## 💡 关键代码

### 穿衣建议算法

```python
def get_clothing_suggestion(self, temp):
    """根据温度给出穿衣建议"""
    try:
        temp = int(temp)
        if temp >= 28:
            return "👕 短袖短裤，注意防晒"
        elif temp >= 23:
            return "👔 短袖长裤，舒适凉爽"
        elif temp >= 18:
            return "👕 长袖薄外套，早晚加件衣服"
        elif temp >= 13:
            return "🧥 薄外套或卫衣，适当保暖"
        elif temp >= 8:
            return "🧥 厚外套，建议穿毛衣"
        elif temp >= 3:
            return "🧥 冬装外套，保暖很重要"
        else:
            return "🧥 羽绒服或棉衣，注意保暖防寒"
    except:
        return "👔 根据天气适当增减衣物"
```

### 失败重试机制

```python
def fetch_hot_news(self, limit=10):
    """获取热点新闻 - 使用知乎热榜"""
    try:
        # 主方案：知乎热榜
        response = requests.get(url, headers=headers, timeout=10)
        if response.status_code == 200:
            # 处理数据...
        else:
            # 备用方案
            self._fetch_baidu_hot(limit)
    except Exception as e:
        # 异常时使用备用方案
        self._fetch_baidu_hot(limit)
```

---

## 📊 推送内容模块

每次推送包含以下内容：

1. **天气预报**
   - 今天：温度、天气、湿度
   - 明天：温度范围、天气
   - 穿衣建议

2. **热点新闻**（6条）
   - 标题
   - 热度值
   - 排名（前三特殊标记）

3. **今日头条**（6条）
   - 标题
   - 热度值

4. **抖音热榜**（6条）
   - 标题
   - 热度值

5. **科技资讯**（5条）
   - 标题
   - 摘要（前5条）
   - 阅读链接

6. **AI 前沿**（3条）
   - 标题
   - 摘要（前3条）
   - 阅读链接

---

## 🎨 设计风格

### 颜色方案

- **背景色**：`#f5f5f7`（浅灰）
- **文字色**：`#1d1d1f`（深灰）
- **次要文字**：`#86868b`（灰色）
- **强调色**：`#007aff`（蓝色）
- **热度标签**：`#ff3b30`（红色）
- **天气渐变**：`#007aff → #5ac8fa`

### 设计理念

- 简洁清爽，易于阅读
- 移动端优化，适配微信浏览器
- Apple 风格，专业感强
- 信息密度适中，不拥挤

---

## 📈 项目进展

### 已完成 ✅

- [x] 本地开发和测试
- [x] 多数据源聚合
- [x] 失败重试机制
- [x] 简洁白 UI 设计
- [x] 内容长度优化
- [x] GitHub 账号创建
- [x] 代码推送到 GitHub
- [x] GitHub Secrets 配置
- [x] GitHub Actions 配置
- [x] 修复城市配置问题
- [x] 添加穿衣建议功能

### 待验证 🔄

- [ ] 确认石家庄天气显示正确
- [ ] 确认穿衣建议显示正确
- [ ] 验证定时任务自动执行

---

## 🔮 未来优化方向

### 功能增强

1. **个性化设置**
   - 用户自定义关注的新闻类别
   - 可配置的推送时间
   - 多城市天气支持

2. **内容丰富**
   - 财经新闻
   - 体育赛事
   - 历史上的今天
   - 每日一句励志语录

3. **交互功能**
   - 关键词订阅
   - 新闻收藏
   - 阅读反馈

### 技术优化

1. **性能优化**
   - 并发请求提升速度
   - 缓存机制减少 API 调用
   - 数据库存储历史记录

2. **稳定性提升**
   - 更多备用 API 源
   - 错误监控和告警
   - 失败重试次数控制

3. **代码质量**
   - 单元测试
   - 代码注释完善
   - 类型提示（Type Hints）

---

## 🙏 致谢

感谢以下开源项目和免费服务：

- **GitHub Actions** - 免费的自动化平台
- **PushPlus** - 微信推送服务
- **wttr.in** - 免费天气 API
- **RSSHub** - RSS 聚合服务
- **知乎、百度、今日头条、抖音** - 热榜数据源
- **36氪、少数派、爱范儿** - 科技新闻源

---

## 📞 联系方式

- **GitHub**: https://github.com/angelbaby12138one-netizen
- **项目仓库**: https://github.com/angelbaby12138one-netizen/daily-news-to-wechat

---

**最后更新时间**: 2025-10-22

**项目状态**: ✅ 开发完成，等待最终测试验证
